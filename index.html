<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">
<title>Interface IA - Starky</title>

<!-- Import Google Fonts et Material Icons -->
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">

<style>
  :root {
    --vh: 1vh;

    /* Variables pour th√®me sombre */
    --bg-primary: #0a0a0a;
    --bg-secondary: #111;
    --bg-tertiary: #1a1a1a;
    --text-primary: #fff;
    --text-secondary: #ccc;
    --text-tertiary: #999;
    --border-color: #222;
    --accent-color: #0ea5e9;
    --hover-bg: rgba(255,255,255,0.05);
    --user-msg-bg: #0ea5e9;
    --bot-msg-bg: #111;
    --overlay-bg: rgba(0,0,0,0.35);
    --input-bg: #111;
  }

  /* Th√®me clair */
  body.light-mode {
    --bg-primary: #f8f9fa;
    --bg-secondary: #ffffff;
    --bg-tertiary: #f1f3f5;
    --text-primary: #1a1a1a;
    --text-secondary: #4a5568;
    --text-tertiary: #718096;
    --border-color: #e2e8f0;
    --accent-color: #0ea5e9;
    --hover-bg: rgba(0,0,0,0.05);
    --user-msg-bg: #0ea5e9;
    --bot-msg-bg: #f1f3f5;
    --overlay-bg: rgba(0,0,0,0.25);
    --input-bg: #ffffff;
  }

  * {
    box-sizing: border-box;
    /* BLOQUER LA S√âLECTION DE TEXTE ET D'IMAGES */
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    -webkit-touch-callout: none;
  }

  /* Permettre la s√©lection UNIQUEMENT dans les champs de texte */
  input, textarea {
    -webkit-user-select: text;
    -moz-user-select: text;
    -ms-user-select: text;
    user-select: text;
  }

  /* Emp√™cher le drag des images */
  img {
    pointer-events: none;
    -webkit-user-drag: none;
    -khtml-user-drag: none;
    -moz-user-drag: none;
    -o-user-drag: none;
    user-drag: none;
  }

  html {
    /* Emp√™cher le zoom et le d√©placement */
    touch-action: pan-x pan-y;
    -ms-touch-action: pan-x pan-y;
  }

  body {
    margin: 0;
    background: var(--bg-primary);
    color: var(--text-primary);
    font-family: 'Space Grotesk', system-ui, sans-serif;
    height: calc(var(--vh) * 100);
    overflow: hidden;
    transition: background 0.3s ease, color 0.3s ease;
    /* Emp√™cher le zoom et le d√©placement */
    touch-action: pan-x pan-y;
    -ms-touch-action: pan-x pan-y;
    position: fixed;
    width: 100%;
  }

  /* HEADER */
  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 14px;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 60px;
    background: var(--bg-secondary);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border-color);
    z-index: 100;
    transition: background 0.3s ease, border-color 0.3s ease;
    touch-action: none;
  }

  .btn {
    width: 42px;
    height: 42px;
    border-radius: 10px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    touch-action: manipulation;
  }

  .btn:hover {
    background: var(--hover-bg);
    transform: scale(1.05);
  }

  .btn .material-icons-outlined {
    font-size: 22px;
    color: var(--text-primary);
    transition: color 0.3s ease;
  }

  .ia-name {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: 25px;
    padding: 8px 18px;
    font-weight: 700;
    font-size: 15px;
    color: var(--accent-color);
    text-align: center;
    transition: all 0.3s ease;
  }

  /* OVERLAY */
  .overlay {
    position: fixed;
    inset: 0;
    background: var(--overlay-bg);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s ease;
    z-index: 190;
  }
  .overlay.active {
    opacity: 1;
    pointer-events: auto;
  }

  /* MENU MODERNE */
  .menu {
    position: fixed;
    top: 0;
    left: -260px;
    width: 260px;
    height: 100%;
    background: var(--bg-secondary);
    backdrop-filter: blur(10px);
    transition: left 0.28s ease, background 0.3s ease;
    border-right: 1px solid var(--border-color);
    z-index: 200;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
  }

  .menu.active { left: 0; }

  .menu-header {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 18px 12px;
    font-weight: 700;
    font-size: 17px;
    color: var(--accent-color);
    gap: 8px;
    flex-shrink: 0;
  }

  .menu a {
    display: flex;
    align-items: center;
    gap: 12px;
    color: var(--text-secondary);
    text-decoration: none;
    padding: 10px 14px;
    font-size: 15px;
    transition: background 0.2s, color 0.2s;
    border-radius: 8px;
    margin: 6px 8px;
    touch-action: manipulation;
  }

  .menu a:hover {
    background: var(--accent-color);
    color: #fff;
  }

  .menu a .material-icons-outlined {
    font-size: 20px;
  }

  .menu-footer {
    margin-top: auto;
    padding: 12px;
    border-top: 1px solid var(--border-color);
    text-align: center;
    flex-shrink: 0;
  }

  /* Bouton de connexion dans le menu */
  .connect-btn {
    width: 100%;
    padding: 12px 16px;
    background: var(--accent-color);
    border: none;
    border-radius: 10px;
    color: #fff;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s;
    font-family: 'Space Grotesk', sans-serif;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    touch-action: manipulation;
  }

  .connect-btn:hover {
    background: #0284c7;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
  }

  .connect-btn:active {
    transform: translateY(0);
  }

  /* Informations utilisateur connect√© - UNE SEULE LIGNE SANS BOUTON */
  .user-connected {
    display: none;
    flex-direction: row;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: var(--hover-bg);
    border-radius: 12px;
    cursor: pointer;
    transition: background 0.2s;
    touch-action: manipulation;
  }

  .user-connected:hover {
    background: rgba(255,255,255,0.08);
  }

  .user-connected.active {
    display: flex;
  }

  .user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent-color), #0284c7);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    font-weight: 700;
    color: #fff;
    flex-shrink: 0;
  }

  .user-info {
    flex: 1;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  .user-display-name {
    color: var(--text-primary);
    font-weight: 600;
    font-size: 14px;
    transition: color 0.3s;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  /* MODAL D'AUTHENTIFICATION */
  .auth-modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 500;
    backdrop-filter: blur(8px);
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .auth-modal.active {
    display: flex;
    opacity: 1;
  }

  .auth-container {
    background: var(--bg-secondary);
    border-radius: 20px;
    max-width: 450px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    border: 1px solid var(--border-color);
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    transition: background 0.3s ease, border-color 0.3s ease;
    animation: slideUp 0.3s ease;
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .auth-header {
    padding: 24px 24px 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .auth-title {
    font-size: 24px;
    font-weight: 700;
    color: var(--text-primary);
    transition: color 0.3s;
  }

  .close-auth {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    touch-action: manipulation;
  }

  .close-auth:hover {
    background: var(--hover-bg);
    transform: rotate(90deg);
  }

  .close-auth .material-icons-outlined {
    font-size: 20px;
    color: var(--text-primary);
    transition: color 0.3s;
  }

  /* Onglets */
  .auth-tabs {
    display: flex;
    gap: 8px;
    padding: 20px 24px;
    border-bottom: 1px solid var(--border-color);
    transition: border-color 0.3s;
  }

  .tab-btn {
    flex: 1;
    padding: 10px 16px;
    background: transparent;
    border: none;
    border-radius: 8px;
    color: var(--text-secondary);
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s;
    font-family: 'Space Grotesk', sans-serif;
    position: relative;
    touch-action: manipulation;
  }

  .tab-btn:hover {
    background: var(--hover-bg);
  }

  .tab-btn.active {
    background: var(--accent-color);
    color: #fff;
  }

  /* Formulaires */
  .auth-body {
    padding: 24px;
  }

  .auth-form {
    display: none;
  }

  .auth-form.active {
    display: block;
  }

  .form-group {
    margin-bottom: 16px;
  }

  .form-label {
    display: block;
    color: var(--text-secondary);
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 8px;
    transition: color 0.3s;
  }

  .form-input {
    width: 100%;
    padding: 12px 16px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    color: var(--text-primary);
    font-size: 15px;
    font-family: 'Space Grotesk', sans-serif;
    transition: all 0.2s;
  }

  .form-input::placeholder {
    color: var(--text-tertiary);
    transition: color 0.3s;
  }

  .form-input:focus {
    outline: none;
    border-color: var(--accent-color);
    background: var(--bg-secondary);
    box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
  }

  .submit-btn {
    width: 100%;
    padding: 14px 16px;
    background: var(--accent-color);
    border: none;
    border-radius: 10px;
    color: #fff;
    font-weight: 700;
    font-size: 15px;
    cursor: pointer;
    transition: all 0.2s;
    font-family: 'Space Grotesk', sans-serif;
    margin-top: 8px;
    touch-action: manipulation;
  }

  .submit-btn:hover {
    background: #0284c7;
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(14, 165, 233, 0.3);
  }

  .submit-btn:active {
    transform: translateY(0);
  }

  .form-footer {
    text-align: center;
    margin-top: 20px;
    color: var(--text-tertiary);
    font-size: 13px;
    transition: color 0.3s;
  }

  /* Menu contextuel de d√©connexion */
  .user-menu {
    position: fixed;
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 8px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.3);
    z-index: 300;
    display: none;
    min-width: 180px;
  }

  .user-menu.active {
    display: block;
  }

  .user-menu-item {
    padding: 10px 16px;
    color: var(--text-primary);
    cursor: pointer;
    border-radius: 8px;
    transition: background 0.2s;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 14px;
    touch-action: manipulation;
  }

  .user-menu-item:hover {
    background: var(--hover-bg);
  }

  .user-menu-item.danger {
    color: #ff4444;
  }

  .user-menu-item.danger:hover {
    background: rgba(255, 68, 68, 0.1);
  }

  /* HISTORIQUE (accord√©on) */
  .accordion {
    margin: 6px 8px;
    border-radius: 8px;
    overflow: hidden;
    flex-shrink: 0;
  }

  .acc-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    padding: 10px 14px;
    background: transparent;
    color: var(--text-secondary);
    cursor: pointer;
    user-select: none;
    transition: background 0.15s, color 0.3s;
    touch-action: manipulation;
  }

  .acc-header:hover {
    background: var(--hover-bg);
  }

  .acc-title {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 15px;
  }

  .acc-chevron {
    transition: transform 0.2s ease, color 0.3s ease;
    color: var(--text-secondary);
  }

  .acc-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.28s ease;
    background: var(--hover-bg);
  }

  /* Conteneur avec scroll pour l'historique */
  .history-list {
    max-height: 200px;
    overflow-y: auto;
    padding: 4px 0;
    padding-left: 46px;
  }

  /* Scrollbar personnalis√©e */
  .history-list::-webkit-scrollbar {
    width: 6px;
  }

  .history-list::-webkit-scrollbar-track {
    background: transparent;
  }

  .history-list::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 3px;
  }

  .history-list::-webkit-scrollbar-thumb:hover {
    background: var(--text-tertiary);
  }

  /* Item d'historique avec bouton trois points */
  .history-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 14px 8px 0;
    color: var(--text-secondary);
    text-decoration: none;
    font-size: 14px;
    border-radius: 6px;
    margin: 6px 8px 6px 0;
    transition: background 0.2s, color 0.2s;
    position: relative;
    cursor: pointer;
    touch-action: manipulation;
  }

  .history-item:hover {
    background: var(--hover-bg);
    color: var(--text-primary);
  }

  .history-item-text {
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .history-item-actions {
    opacity: 1;
    display: flex;
    align-items: center;
  }

  .delete-btn {
    background: transparent;
    border: none;
    padding: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-tertiary);
    transition: color 0.2s, transform 0.2s;
    border-radius: 4px;
    touch-action: manipulation;
  }

  .delete-btn:hover {
    color: var(--accent-color);
    background: var(--hover-bg);
    transform: scale(1.1);
  }

  .delete-btn .material-icons-outlined {
    font-size: 18px;
  }

  /* WELCOME */
  .welcome {
    position: absolute;
    top: 85px;
    left: 0;
    right: 0;
    text-align: center;
    font-size: 18px;
    color: var(--text-secondary);
    font-weight: 700;
    transition: opacity 0.4s ease, transform 0.4s ease, color 0.3s ease;
  }

  /* CHAT */
  .chat {
    position: absolute;
    top: 95px;
    bottom: 140px;
    left: 0;
    right: 0;
    overflow-y: auto;
    padding: 0 15px 15px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    touch-action: pan-y;
  }

  /* Scrollbar personnalis√©e pour le chat */
  .chat::-webkit-scrollbar {
    width: 8px;
  }

  .chat::-webkit-scrollbar-track {
    background: transparent;
  }

  .chat::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 4px;
  }

  .chat::-webkit-scrollbar-thumb:hover {
    background: var(--text-tertiary);
  }

  .msg {
    max-width: 80%;
    padding: 10px 14px;
    border-radius: 18px;
    word-wrap: break-word;
    font-size: 14px;
    transition: background 0.3s ease, color 0.3s ease;
  }

  .user {
    align-self: flex-end;
    background: var(--user-msg-bg);
    color: #fff;
    border-bottom-right-radius: 4px;
  }

  .bot {
    align-self: flex-start;
    background: var(--bot-msg-bg);
    color: var(--text-primary);
    border-bottom-left-radius: 4px;
  }

  /* ANIMATION DES TROIS POINTS */
  .typing-indicator {
    align-self: flex-start;
    background: var(--bot-msg-bg);
    color: var(--text-primary);
    border-radius: 18px;
    border-bottom-left-radius: 4px;
    padding: 10px 14px;
    display: flex;
    align-items: center;
    gap: 4px;
    transition: background 0.3s ease;
  }

  .typing-indicator span {
    width: 8px;
    height: 8px;
    background: var(--accent-color);
    border-radius: 50%;
    display: inline-block;
    animation: typing 1.4s infinite;
  }

  .typing-indicator span:nth-child(2) {
    animation-delay: 0.2s;
  }

  .typing-indicator span:nth-child(3) {
    animation-delay: 0.4s;
  }

  @keyframes typing {
    0%, 60%, 100% {
      transform: translateY(0);
      opacity: 0.5;
    }
    30% {
      transform: translateY(-10px);
      opacity: 1;
    }
  }

  /* INPUT WRAPPER */
  .input-wrapper {
    position: fixed;
    bottom: 15px;
    left: 0;
    right: 0;
    display: flex;
    justify-content: center;
    padding: 0 12px;
    z-index: 150;
    touch-action: none;
  }

  /* INPUT BOX */
  .input-box {
    width: 100%;
    max-width: 560px;
    background: var(--input-bg);
    border: 1px solid var(--border-color);
    border-radius: 20px;
    padding: 12px 16px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    transition: background 0.3s ease, border-color 0.3s ease;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  body.light-mode .input-box {
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  }

  /* Aper√ßu m√©dia */
  .media-preview-container {
    display: none;
    align-items: center;
    gap: 8px;
    padding: 8px;
    background: var(--hover-bg);
    border-radius: 10px;
    transition: background 0.3s ease;
  }

  .media-preview-container.active {
    display: flex;
  }

  .media-preview {
    width: 40px;
    height: 40px;
    object-fit: cover;
    border-radius: 6px;
    border: 1px solid var(--border-color);
  }

  .media-preview-name {
    font-size: 12px;
    color: var(--text-tertiary);
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    transition: color 0.3s ease;
  }

  .media-remove {
    background: transparent;
    border: none;
    color: #ff4444;
    cursor: pointer;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s;
    touch-action: manipulation;
  }

  .media-remove:hover {
    transform: scale(1.1);
  }

  .media-remove .material-icons-outlined {
    font-size: 20px;
  }

  /* Zone de texte */
  .input-row {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .input-row input {
    flex: 1;
    background: transparent;
    border: none;
    color: var(--text-primary);
    font-size: 16px;
    outline: none;
    transition: color 0.3s ease;
  }

  .input-row input::placeholder {
    color: var(--text-tertiary);
    transition: color 0.3s ease;
  }

  /* Bouton envoyer */
  .send-btn {
    background: #333;
    border: none;
    width: 38px;
    height: 38px;
    border-radius: 50%;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background 0.3s, transform 0.2s;
    flex-shrink: 0;
    touch-action: manipulation;
  }

  .send-btn:active {
    transform: scale(0.95);
  }

  .icon {
    width: 20px;
    height: 20px;
    fill: none;
    stroke: #fff;
    stroke-width: 2;
    stroke-linecap: round;
    stroke-linejoin: round;
  }

  /* Boutons m√©dia et vocal */
  .button-row {
    display: flex;
    align-items: center;
    gap: 8px;
    padding-top: 4px;
    border-top: 1px solid var(--border-color);
    transition: border-color 0.3s ease;
  }

  .media-btn {
    background: transparent;
    border: none;
    color: var(--text-tertiary);
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
    font-size: 13px;
    padding: 6px 10px;
    border-radius: 8px;
    transition: background 0.2s, color 0.2s;
    touch-action: manipulation;
  }

  .media-btn:hover:not(:disabled) {
    background: var(--hover-bg);
    color: var(--text-primary);
  }

  .media-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }

  .media-btn .material-icons-outlined {
    font-size: 18px;
  }

  #mediaInput {
    display: none;
  }

  /* Notification */
  .notification {
    position: fixed;
    top: 80px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--bg-secondary);
    border: 1px solid var(--accent-color);
    color: var(--text-primary);
    padding: 12px 24px;
    border-radius: 12px;
    z-index: 300;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease, background 0.3s ease, color 0.3s ease;
  }

  .notification.show {
    opacity: 1;
    pointer-events: auto;
  }

  /* Modal de confirmation */
  .confirm-modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 400;
  }

  .confirm-modal.active {
    display: flex;
  }

  .confirm-content {
    background: var(--bg-secondary);
    padding: 24px;
    border-radius: 16px;
    max-width: 400px;
    width: 90%;
    border: 1px solid var(--border-color);
    box-shadow: 0 8px 24px rgba(0,0,0,0.3);
    transition: background 0.3s ease, border-color 0.3s ease;
  }

  .confirm-title {
    font-size: 18px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 12px;
    transition: color 0.3s ease;
  }

  .confirm-message {
    color: var(--text-secondary);
    margin-bottom: 24px;
    transition: color 0.3s ease;
  }

  .confirm-buttons {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
  }

  .confirm-btn {
    padding: 10px 20px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-weight: 600;
    font-size: 14px;
    transition: all 0.2s;
    touch-action: manipulation;
  }

  .confirm-btn.cancel {
    background: var(--bg-tertiary);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
  }

  .confirm-btn.cancel:hover {
    background: var(--hover-bg);
  }

  .confirm-btn.delete {
    background: #ff4444;
    color: #fff;
  }

  .confirm-btn.delete:hover {
    background: #cc0000;
  }

  /* Responsive */
  @media (max-width: 420px) {
    .menu { width: 240px; left: -240px; }
    .input-box { max-width: 420px; }
  }
</style>
</head>
<body>

  <!-- HEADER -->
  <div class="header">
    <button class="btn" id="menuBtn" aria-label="Ouvrir le menu"><span class="material-icons-outlined">menu</span></button>
    <div class="ia-name">Starky</div>
    <button class="btn" id="themeBtn" aria-label="Th√®me"><span class="material-icons-outlined">light_mode</span></button>
  </div>

  <!-- OVERLAY -->
  <div id="overlay" class="overlay" tabindex="-1"></div>

  <!-- MENU MODERNE -->
  <nav class="menu" id="sideMenu" aria-hidden="true" aria-label="Menu principal">
    <div class="menu-header">
      <span class="material-icons-outlined">chat</span>
      <span style="font-weight:700;">Starky</span>
    </div>

    <a href="#" id="newChatLink"><span class="material-icons-outlined">chat</span>New Chat</a>

    <div class="accordion" id="historyAcc">
      <div class="acc-header" id="accHeader" role="button" aria-expanded="false" tabindex="0">
        <div class="acc-title"><span class="material-icons-outlined">history</span><span>Historique</span></div>
        <span class="material-icons-outlined acc-chevron" id="accChevron">expand_more</span>
      </div>
      <div class="acc-content" id="accContent" aria-hidden="true">
        <div class="history-list" id="historyList">
          <!-- Les conversations seront ajout√©es ici dynamiquement -->
        </div>
      </div>
    </div>

    <a href="#"><span class="material-icons-outlined">dashboard</span>Tableau de bord</a>
    <a href="#"><span class="material-icons-outlined">description</span>Documentation</a>
    <a href="#"><span class="material-icons-outlined">settings</span>Param√®tres</a>

    <div class="menu-footer">
      <!-- Bouton de connexion (affich√© si non connect√©) -->
      <button class="connect-btn" id="openAuthBtn">
        <span class="material-icons-outlined">login</span>
        <span>Se connecter</span>
      </button>

      <!-- Informations utilisateur (affich√© si connect√©) - UNE SEULE LIGNE SANS BOUTON -->
      <div class="user-connected" id="userConnected">
        <div class="user-avatar" id="userAvatar">JS</div>
        <div class="user-info">
          <div class="user-display-name" id="userDisplayName">john.doe@example.com</div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Menu contextuel de l'utilisateur -->
  <div class="user-menu" id="userMenu">
    <div class="user-menu-item" id="profileMenuItem">
      <span class="material-icons-outlined" style="font-size: 18px;">person</span>
      <span>Profil</span>
    </div>
    <div class="user-menu-item danger" id="disconnectMenuItem">
      <span class="material-icons-outlined" style="font-size: 18px;">logout</span>
      <span>Se d√©connecter</span>
    </div>
  </div>

  <!-- MODAL D'AUTHENTIFICATION -->
  <div class="auth-modal" id="authModal">
    <div class="auth-container">
      <div class="auth-header">
        <div class="auth-title">Bienvenue</div>
        <button class="close-auth" id="closeAuthBtn">
          <span class="material-icons-outlined">close</span>
        </button>
      </div>

      <!-- Onglets -->
      <div class="auth-tabs">
        <button class="tab-btn active" data-tab="login">Connexion</button>
        <button class="tab-btn" data-tab="register">Inscription</button>
      </div>

      <!-- Corps -->
      <div class="auth-body">
        <!-- Formulaire de connexion -->
        <form class="auth-form active" id="loginForm">
          <div class="form-group">
            <label class="form-label" for="loginEmail">Email</label>
            <input type="email" class="form-input" id="loginEmail" placeholder="votreemail@example.com" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="loginPassword">Mot de passe</label>
            <input type="password" class="form-input" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
          </div>
          <button type="submit" class="submit-btn">Se connecter</button>
          <div class="form-footer">
            Vous n'avez pas de compte ? <a href="#" class="switch-tab" data-tab="register" style="color: var(--accent-color); text-decoration: none; font-weight: 600;">Inscrivez-vous</a>
          </div>
        </form>

        <!-- Formulaire d'inscription -->
        <form class="auth-form" id="registerForm">
          <div class="form-group">
            <label class="form-label" for="registerFirstName">Pr√©nom</label>
            <input type="text" class="form-input" id="registerFirstName" placeholder="Votre pr√©nom" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="registerLastName">Nom</label>
            <input type="text" class="form-input" id="registerLastName" placeholder="Votre nom" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="registerEmail">Email</label>
            <input type="email" class="form-input" id="registerEmail" placeholder="votreemail@example.com" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="registerPassword">Mot de passe</label>
            <input type="password" class="form-input" id="registerPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
          </div>
          <button type="submit" class="submit-btn">S'inscrire</button>
          <div class="form-footer">
            Vous avez d√©j√† un compte ? <a href="#" class="switch-tab" data-tab="login" style="color: var(--accent-color); text-decoration: none; font-weight: 600;">Connectez-vous</a>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div id="welcome" class="welcome"><strong>Bienvenue sur Starky</strong> üòä</div>

  <div id="chat" class="chat" role="log" aria-live="polite"></div>

  <!-- Notification -->
  <div id="notification" class="notification"></div>

  <!-- Modal de confirmation -->
  <div id="confirmModal" class="confirm-modal">
    <div class="confirm-content">
      <div class="confirm-title">Confirmer la suppression</div>
      <div class="confirm-message">√ätes-vous s√ªr de vouloir supprimer cette conversation ?</div>
      <div class="confirm-buttons">
        <button class="confirm-btn cancel" id="cancelDelete">Annuler</button>
        <button class="confirm-btn delete" id="confirmDelete">Supprimer</button>
      </div>
    </div>
  </div>

  <!-- INPUT WRAPPER -->
  <div class="input-wrapper">
    <div class="input-box">
      <!-- Aper√ßu m√©dia -->
      <div class="media-preview-container" id="mediaPreview">
        <img class="media-preview" id="previewImage" src="" alt="Aper√ßu">
        <span class="media-preview-name" id="previewName"></span>
        <button class="media-remove" id="removeMedia" aria-label="Supprimer le m√©dia">
          <span class="material-icons-outlined">close</span>
        </button>
      </div>

      <!-- Zone de texte -->
      <div class="input-row">
        <input id="prompt" type="text" placeholder="√âcrire un message..." autocomplete="off" aria-label="Message">
        <button id="actionBtn" class="send-btn" aria-label="Envoyer">
          <svg class="icon" id="iconSend" viewBox="0 0 24 24">
            <path d="M22 2L11 13"/>
            <path d="M22 2L15 22L11 13L2 9L22 2Z"/>
          </svg>
        </button>
      </div>

      <!-- Boutons m√©dia et vocal -->
      <div class="button-row">
        <button class="media-btn" id="mediaBtn">
          <span class="material-icons-outlined">attach_file</span>
          <span>M√©dia</span>
        </button>
        <button class="media-btn" id="voiceBtn" disabled title="Chat vocal - Prochainement">
          <span class="material-icons-outlined">mic</span>
          <span>Chat vocal</span>
        </button>
        <input type="file" id="mediaInput" accept="image/*,video/*,audio/*" multiple>
      </div>
    </div>
  </div>

<script>
  // ===========================
  // BLOQUER ACTIONS PAR D√âFAUT
  // ===========================
  // Emp√™cher le menu contextuel (clic droit)
  document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
  }, false);

  // Emp√™cher la s√©lection de texte par double-clic ou drag
  document.addEventListener('selectstart', function(e) {
    // Autoriser la s√©lection dans les inputs et textareas
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
      return true;
    }
    e.preventDefault();
  }, false);

  // Emp√™cher le drag d'images
  document.addEventListener('dragstart', function(e) {
    if (e.target.tagName === 'IMG') {
      e.preventDefault();
    }
  }, false);

  // Emp√™cher certaines combinaisons de touches (Ctrl+A, Ctrl+C, etc.)
  document.addEventListener('keydown', function(e) {
    // Si on est dans un input ou textarea, on autorise
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
      return true;
    }

    // Bloquer Ctrl+A (tout s√©lectionner)
    if (e.ctrlKey && e.key === 'a') {
      e.preventDefault();
    }
    // Bloquer Ctrl+C (copier)
    if (e.ctrlKey && e.key === 'c') {
      e.preventDefault();
    }
  }, false);

  // Emp√™cher le zoom par double-tap
  let lastTouchEnd = 0;
  document.addEventListener('touchend', function(e) {
    const now = (new Date()).getTime();
    if (now - lastTouchEnd <= 300) {
      e.preventDefault();
    }
    lastTouchEnd = now;
  }, false);

  // Emp√™cher le zoom par pinch
  document.addEventListener('gesturestart', function(e) {
    e.preventDefault();
  });

  document.addEventListener('gesturechange', function(e) {
    e.preventDefault();
  });

  document.addEventListener('gestureend', function(e) {
    e.preventDefault();
  });

  // ===========================
  // VARIABLES GLOBALES
  // ===========================
  // D√©finir --vh pour g√©rer la hauteur visible
  function setVh() {
    const height = window.visualViewport ? window.visualViewport.height : window.innerHeight;
    document.documentElement.style.setProperty('--vh', (height * 0.01) + 'px');
  }
  setVh();
  if (window.visualViewport) {
    window.visualViewport.addEventListener('resize', setVh);
    window.visualViewport.addEventListener('scroll', setVh);
  } else {
    window.addEventListener('resize', setVh);
  }

  const input = document.getElementById('prompt');
  const chat = document.getElementById('chat');
  const iconSend = document.getElementById('iconSend');
  const actionBtn = document.getElementById('actionBtn');
  const welcome = document.getElementById('welcome');
  const menuBtn = document.getElementById('menuBtn');
  const sideMenu = document.getElementById('sideMenu');
  const overlay = document.getElementById('overlay');
  const themeBtn = document.getElementById('themeBtn');

  const accHeader = document.getElementById('accHeader');
  const accContent = document.getElementById('accContent');
  const accChevron = document.getElementById('accChevron');
  const historyList = document.getElementById('historyList');

  const mediaBtn = document.getElementById('mediaBtn');
  const voiceBtn = document.getElementById('voiceBtn');
  const mediaInput = document.getElementById('mediaInput');
  const mediaPreview = document.getElementById('mediaPreview');
  const previewImage = document.getElementById('previewImage');
  const previewName = document.getElementById('previewName');
  const removeMedia = document.getElementById('removeMedia');

  const confirmModal = document.getElementById('confirmModal');
  const cancelDelete = document.getElementById('cancelDelete');
  const confirmDelete = document.getElementById('confirmDelete');

  // √âl√©ments d'authentification
  const authModal = document.getElementById('authModal');
  const openAuthBtn = document.getElementById('openAuthBtn');
  const closeAuthBtn = document.getElementById('closeAuthBtn');
  const loginForm = document.getElementById('loginForm');
  const registerForm = document.getElementById('registerForm');
  const userConnected = document.getElementById('userConnected');
  const userDisplayName = document.getElementById('userDisplayName');
  const userAvatar = document.getElementById('userAvatar');
  const userMenu = document.getElementById('userMenu');
  const disconnectMenuItem = document.getElementById('disconnectMenuItem');
  const profileMenuItem = document.getElementById('profileMenuItem');

  let selectedFile = null;
  let conversationHistory = [];
  let conversationIdToDelete = null;
  let currentConversationId = null;
  let isFirstMessage = true;
  let currentUser = null;

  // ===========================
  // GESTION DE L'AUTHENTIFICATION
  // ===========================

  // Ouvrir la modal d'authentification
  openAuthBtn.addEventListener('click', function() {
    authModal.classList.add('active');
    closeMenu();
  });

  // Fermer la modal d'authentification
  closeAuthBtn.addEventListener('click', function() {
    authModal.classList.remove('active');
  });

  // Fermer en cliquant √† l'ext√©rieur
  authModal.addEventListener('click', function(e) {
    if (e.target === authModal) {
      authModal.classList.remove('active');
    }
  });

  // Gestion des onglets
  const tabBtns = document.querySelectorAll('.tab-btn');
  const authForms = document.querySelectorAll('.auth-form');

  tabBtns.forEach(btn => {
    btn.addEventListener('click', function() {
      const targetTab = this.getAttribute('data-tab');

      // Mettre √† jour les boutons d'onglets
      tabBtns.forEach(b => b.classList.remove('active'));
      this.classList.add('active');

      // Afficher le bon formulaire
      authForms.forEach(form => {
        if (form.id === targetTab + 'Form') {
          form.classList.add('active');
        } else {
          form.classList.remove('active');
        }
      });
    });
  });

  // Gestion des liens de basculement entre formulaires
  const switchTabLinks = document.querySelectorAll('.switch-tab');
  switchTabLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const targetTab = this.getAttribute('data-tab');
      const targetBtn = document.querySelector(`.tab-btn[data-tab="${targetTab}"]`);
      if (targetBtn) {
        targetBtn.click();
      }
    });
  });

  // Soumission du formulaire de connexion
  loginForm.addEventListener('submit', function(e) {
    e.preventDefault();

    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value.trim();

    if (!email || !password) {
      showNotification('Veuillez remplir tous les champs');
      return;
    }

    // Validation email
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      showNotification('Adresse email invalide');
      return;
    }

    // Simulation de connexion (√† remplacer par une vraie authentification)
    currentUser = {
      firstName: 'John',
      lastName: 'Doe',
      email: email
    };

    updateUserDisplay();
    authModal.classList.remove('active');
    showNotification('Connexion r√©ussie !');

    // R√©initialiser le formulaire
    loginForm.reset();
  });

  // Soumission du formulaire d'inscription
  registerForm.addEventListener('submit', function(e) {
    e.preventDefault();

    const firstName = document.getElementById('registerFirstName').value.trim();
    const lastName = document.getElementById('registerLastName').value.trim();
    const email = document.getElementById('registerEmail').value.trim();
    const password = document.getElementById('registerPassword').value.trim();

    if (!firstName || !lastName || !email || !password) {
      showNotification('Veuillez remplir tous les champs');
      return;
    }

    // Validation email
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      showNotification('Adresse email invalide');
      return;
    }

    // Validation mot de passe
    if (password.length < 6) {
      showNotification('Le mot de passe doit contenir au moins 6 caract√®res');
      return;
    }

    // Simulation d'inscription (√† remplacer par une vraie authentification)
    currentUser = {
      firstName: firstName,
      lastName: lastName,
      email: email
    };

    updateUserDisplay();
    authModal.classList.remove('active');
    showNotification('Inscription r√©ussie !');

    // R√©initialiser le formulaire
    registerForm.reset();
  });

  // Mettre √† jour l'affichage utilisateur
  function updateUserDisplay() {
    if (currentUser) {
      // Cacher le bouton de connexion
      openAuthBtn.style.display = 'none';

      // Afficher les infos utilisateur
      userConnected.classList.add('active');

      // Afficher soit le nom complet, soit l'email
      const displayText = currentUser.firstName && currentUser.lastName
        ? `${currentUser.firstName} ${currentUser.lastName}`
        : currentUser.email;

      userDisplayName.textContent = displayText;

      // Avatar avec initiales
      let initials;
      if (currentUser.firstName && currentUser.lastName) {
        initials = currentUser.firstName.charAt(0) + currentUser.lastName.charAt(0);
      } else {
        // Si pas de nom, utiliser les 2 premi√®res lettres de l'email
        initials = currentUser.email.substring(0, 2);
      }
      userAvatar.textContent = initials.toUpperCase();
    } else {
      // Afficher le bouton de connexion
      openAuthBtn.style.display = 'flex';

      // Cacher les infos utilisateur
      userConnected.classList.remove('active');
    }
  }

  // Gestion du menu contextuel utilisateur
  userConnected.addEventListener('click', function(e) {
    e.stopPropagation();
    const rect = userConnected.getBoundingClientRect();
    userMenu.style.left = rect.left + 'px';
    userMenu.style.bottom = (window.innerHeight - rect.top + 10) + 'px';
    userMenu.classList.toggle('active');
  });

  // Fermer le menu utilisateur en cliquant ailleurs
  document.addEventListener('click', function(e) {
    if (!userMenu.contains(e.target) && !userConnected.contains(e.target)) {
      userMenu.classList.remove('active');
    }
  });

  // D√©connexion
  disconnectMenuItem.addEventListener('click', function() {
    currentUser = null;
    updateUserDisplay();
    userMenu.classList.remove('active');
    showNotification('D√©connexion r√©ussie');
  });

  // Profil
  profileMenuItem.addEventListener('click', function() {
    userMenu.classList.remove('active');
    showNotification('Profil - Fonctionnalit√© √† venir');
  });

  // ===========================
  // GESTION DU TH√àME
  // ===========================
  let isDarkMode = true;
  themeBtn.addEventListener('click', () => {
    isDarkMode = !isDarkMode;
    if (isDarkMode) {
      document.body.classList.remove('light-mode');
      themeBtn.querySelector('.material-icons-outlined').textContent = 'light_mode';
    } else {
      document.body.classList.add('light-mode');
      themeBtn.querySelector('.material-icons-outlined').textContent = 'dark_mode';
    }
  });

  // ===========================
  // GESTION DES M√âDIAS
  // ===========================

  // Ouvrir s√©lecteur de fichiers
  mediaBtn.addEventListener('click', () => {
    mediaInput.click();
  });

  // Gestion du bouton vocal (inactif pour l'instant)
  voiceBtn.addEventListener('click', () => {
    showNotification('Fonctionnalit√© de chat vocal - Prochainement disponible');
  });

  // Gestion de la s√©lection de fichier
  mediaInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
      selectedFile = file;

      if (file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = (event) => {
          previewImage.src = event.target.result;
          previewImage.style.display = 'block';
        };
        reader.readAsDataURL(file);
      } else {
        previewImage.style.display = 'none';
      }

      previewName.textContent = file.name;
      mediaPreview.classList.add('active');
    }
  });

  // Supprimer le m√©dia
  removeMedia.addEventListener('click', (e) => {
    e.stopPropagation();
    selectedFile = null;
    mediaInput.value = '';
    mediaPreview.classList.remove('active');
    previewImage.src = '';
    previewName.textContent = '';
  });

  // Mise √† jour du style du bouton send
  input.addEventListener('input', () => {
    const hasText = input.value.trim().length > 0;
    actionBtn.style.background = hasText || selectedFile ? '#0ea5e9' : '#333';
  });

  // ===========================
  // GESTION DU CHAT
  // ===========================

  // Ajouter un message
  function addMessage(text, sender, fileInfo = null) {
    if (welcome.style.display !== "none") {
      welcome.style.opacity = "0";
      welcome.style.transform = "translateY(-20px)";
      setTimeout(() => welcome.style.display = "none", 400);
    }
    const msg = document.createElement('div');
    msg.className = 'msg ' + sender;

    if (fileInfo) {
      msg.textContent = text + ' [Fichier joint: ' + fileInfo + ']';
    } else {
      msg.textContent = text;
    }

    chat.appendChild(msg);
    requestAnimationFrame(() => {
      chat.scrollTo({ top: chat.scrollHeight, behavior: 'smooth' });
    });
    return msg;
  }

  // Ajouter l'indicateur de saisie
  function addTypingIndicator() {
    const typing = document.createElement('div');
    typing.className = 'typing-indicator';
    typing.innerHTML = '<span></span><span></span><span></span>';
    chat.appendChild(typing);
    requestAnimationFrame(() => {
      chat.scrollTo({ top: chat.scrollHeight, behavior: 'smooth' });
    });
    return typing;
  }

  // Supprimer l'indicateur de saisie
  function removeTypingIndicator(typingElement) {
    if (typingElement && typingElement.parentNode) {
      typingElement.parentNode.removeChild(typingElement);
    }
  }

  // ===========================
  // GESTION DE L'HISTORIQUE
  // ===========================

  // Fonction pour cr√©er un item d'historique
  function createHistoryItem(conversation) {
    const item = document.createElement('div');
    item.className = 'history-item';
    item.dataset.id = conversation.id;

    const textSpan = document.createElement('span');
    textSpan.className = 'history-item-text';
    textSpan.textContent = conversation.title;

    const actionsDiv = document.createElement('div');
    actionsDiv.className = 'history-item-actions';

    const deleteBtn = document.createElement('button');
    deleteBtn.className = 'delete-btn';
    deleteBtn.setAttribute('aria-label', 'Options');
    deleteBtn.innerHTML = '<span class="material-icons-outlined">more_vert</span>';
    deleteBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      conversationIdToDelete = conversation.id;
      confirmModal.classList.add('active');
    });

    actionsDiv.appendChild(deleteBtn);
    item.appendChild(textSpan);
    item.appendChild(actionsDiv);

    item.addEventListener('click', () => {
      showNotification('Chargement de: ' + conversation.title);
      closeMenu();
    });

    return item;
  }

  // Mettre √† jour l'historique
  function updateHistoryList() {
    historyList.innerHTML = '';
    conversationHistory.forEach(conv => {
      historyList.appendChild(createHistoryItem(conv));
    });

    // Ajuster la hauteur du contenu de l'accord√©on si ouvert
    if (accOpen) {
      accContent.style.maxHeight = accContent.scrollHeight + "px";
    }
  }

  // Ajouter une conversation √† l'historique (uniquement pour le premier message)
  function addToHistory(title) {
    const newConv = {
      id: Date.now(),
      title: title,
      date: new Date()
    };
    conversationHistory.unshift(newConv);
    currentConversationId = newConv.id;
    updateHistoryList();
  }

  // Supprimer une conversation
  function deleteConversation(id) {
    conversationHistory = conversationHistory.filter(conv => conv.id !== id);
    updateHistoryList();
    showNotification('Conversation supprim√©e');
  }

  // Gestion de la modal de confirmation
  cancelDelete.addEventListener('click', () => {
    confirmModal.classList.remove('active');
    conversationIdToDelete = null;
  });

  confirmDelete.addEventListener('click', () => {
    if (conversationIdToDelete !== null) {
      deleteConversation(conversationIdToDelete);
      conversationIdToDelete = null;
    }
    confirmModal.classList.remove('active');
  });

  // Fermer la modal en cliquant √† l'ext√©rieur
  confirmModal.addEventListener('click', (e) => {
    if (e.target === confirmModal) {
      confirmModal.classList.remove('active');
      conversationIdToDelete = null;
    }
  });

  // ===========================
  // ENVOYER UN MESSAGE
  // ===========================

  actionBtn.addEventListener('click', () => {
    const text = input.value.trim();
    if (!text && !selectedFile) return;

    const fileInfo = selectedFile ? selectedFile.name : null;
    addMessage(text || 'Fichier envoy√©', 'user', fileInfo);

    // Sauvegarder dans l'historique UNIQUEMENT si c'est le premier message de la conversation
    if (isFirstMessage && text) {
      addToHistory(text.substring(0, 30) + (text.length > 30 ? '...' : ''));
      isFirstMessage = false;
    }

    input.value = '';
    selectedFile = null;
    mediaInput.value = '';
    mediaPreview.classList.remove('active');
    previewImage.src = '';
    previewName.textContent = '';
    input.dispatchEvent(new Event('input'));

    const typingIndicator = addTypingIndicator();

    setTimeout(() => {
      removeTypingIndicator(typingIndicator);
      addMessage("R√©ponse de Starky : " + (text || 'Fichier re√ßu'), 'bot');
    }, 1500);
  });

  // Support Enter
  input.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      e.preventDefault();
      actionBtn.click();
    }
  });

  // ===========================
  // GESTION DU MENU
  // ===========================

  // Fonction pour fermer le menu
  function closeMenu() {
    sideMenu.classList.remove('active');
    sideMenu.setAttribute('aria-hidden', 'true');
    overlay.classList.remove('active');
  }

  // Ouvrir le menu
  menuBtn.addEventListener('click', () => {
    sideMenu.classList.add('active');
    sideMenu.setAttribute('aria-hidden', 'false');
    overlay.classList.add('active');
    overlay.focus();
  });

  // Fermer le menu via overlay
  overlay.addEventListener('click', closeMenu);

  // Fermer avec √âchap
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      if (authModal.classList.contains('active')) {
        authModal.classList.remove('active');
      } else if (confirmModal.classList.contains('active')) {
        confirmModal.classList.remove('active');
        conversationIdToDelete = null;
      } else if (sideMenu.classList.contains('active')) {
        closeMenu();
      } else if (userMenu.classList.contains('active')) {
        userMenu.classList.remove('active');
      }
    }
  });

  // ===========================
  // ACCORD√âON HISTORIQUE
  // ===========================

  let accOpen = false;
  function toggleAcc() {
    accOpen = !accOpen;
    if (accOpen) {
      accContent.style.maxHeight = accContent.scrollHeight + "px";
      accChevron.style.transform = "rotate(180deg)";
      accHeader.setAttribute('aria-expanded', 'true');
      accContent.setAttribute('aria-hidden', 'false');
    } else {
      accContent.style.maxHeight = "0";
      accChevron.style.transform = "rotate(0deg)";
      accHeader.setAttribute('aria-expanded', 'false');
      accContent.setAttribute('aria-hidden', 'true');
    }
  }
  accHeader.addEventListener('click', toggleAcc);
  accHeader.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      toggleAcc();
    }
  });

  // New Chat - R√©initialise la conversation
  const newChatLink = document.getElementById('newChatLink');
  newChatLink.addEventListener('click', (e) => {
    e.preventDefault();
    chat.innerHTML = '';
    welcome.style.display = 'block';
    welcome.style.opacity = '1';
    welcome.style.transform = 'translateY(0)';
    isFirstMessage = true;
    currentConversationId = null;
    closeMenu();
  });

  // ===========================
  // NOTIFICATION
  // ===========================

  function showNotification(message) {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    notification.classList.add('show');
    setTimeout(() => {
      notification.classList.remove('show');
    }, 3000);
  }

  // ===========================
  // AJUSTEMENT CLAVIER
  // ===========================

  function adjustForKeyboard() {
    const vv = window.visualViewport;
    if (!vv) return;
    const viewportHeight = vv.height;
    const fullHeight = window.innerHeight;
    const keyboardHeight = Math.max(0, fullHeight - viewportHeight);
    const inputWrapper = document.querySelector('.input-wrapper');
    if (keyboardHeight > 150) {
      inputWrapper.style.bottom = (keyboardHeight + 10) + 'px';
      const chatEl = document.getElementById('chat');
      chatEl.style.bottom = (keyboardHeight + 70) + 'px';
    } else {
      inputWrapper.style.bottom = '15px';
      const chatEl = document.getElementById('chat');
      chatEl.style.bottom = '140px';
    }
  }
  if (window.visualViewport) {
    window.visualViewport.addEventListener('resize', () => {
      setVh();
      adjustForKeyboard();
    });
    window.visualViewport.addEventListener('scroll', adjustForKeyboard);
  } else {
    window.addEventListener('resize', () => {
      setVh();
      adjustForKeyboard();
    });
  }

  // ===========================
  // INITIALISATION
  // ===========================

  // Initialiser avec quelques conversations de test
  function initializeTestData() {
    const testConversations = [
      'Comment cr√©er une application web ?',
      'Explique-moi React',
      'Qu\'est-ce que le machine learning ?',
      'Comment optimiser mon code ?',
      'Tutoriel Python pour d√©butants'
    ];

    testConversations.forEach((title, index) => {
      conversationHistory.push({
        id: Date.now() + index,
        title: title,
        date: new Date()
      });
    });

    updateHistoryList();
  }

  // Initialiser les donn√©es de test au chargement
  initializeTestData();

  // Initialiser l'affichage utilisateur
  updateUserDisplay();
</script>

</body>
</html>
